<html><head><style>.cent {  display: block;  margin-left: auto;  margin-right: auto;}</style><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script><body style='margin-left:5%;margin-right:5%;margin-top:1%'><h4>Fichier générer depuis les sources Latex</h4><h5>Auteur : Nicolas Le Guerroué</h5><a href='index.html'><button class='btn btn-success' >Revenir au sommaire</button></a><hr><h3>Présentation</h3> <span id='apache'></span>
Apache est un logiciel qui va faire l’interface entre le serveur et les requêtes émises par le client. Ainsi, toutes les demandes d’affichage des pages Web passent par le logiciel Apache.

Ce dernier va écouter le port HTTP qui est le n°80 par défaut. 

<figure id=''><div class='cent' style='text-align:center;'><img src='/tools-webServer/schema.png' class='alignnone size-medium' style='max-width:60%;'><figcaption>Figure - Le rôle du serveur Apache</figcaption></div></figure>
Les requêtes sécurisées passent, quant à elles par le port n°443. 

<h3>Installation</h3>
Pour installer Apache, rien de plus simple :

<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
sudo apt-get install -y apache2

</code></pre><hr>
<h3>Une petite explication sur les ports</h3>
Pour recevoir et transmettre des données à d’autres ordinateurs, un ordinateur a besoin de ports. Cependant, les ports physiques tel que le port USB, VGA, RS232 et ETHERNET sont peu nombreux. Ainsi, des ports virtuels ont été créés. 

Chaque port virtuel est codé sur 16 bits et permet de faire communiquer un service ou un logiciel.

Par exemple, le service SSH communique sur le port 22. 

Il y a donc potentiellement 65536 ports disponibles. 

Certains numéros de port sont réservés à certains services 

Les ports de 0 à 1023 sont déjà réservés. Il conviendra de prendre un numéro de port non pris par un service dans les configurations à venir. 

Le logiciel Apache gère l’emplacement du répertoire du site Web. 

\bold {Par défaut, le code source du futur site est localisé dans /var/www/html}

<h3>Masquer le serveur</h3>
Tout d’abord, il convient de limiter le nombre d’information que le serveur va afficher en cas de problème. Moins l’utilisateur en sait, meilleure sera la sécurité globale.

Nous allons donc désactiver l’affichage du type de serveur et le système d’exploitation le faisant fonctionner.

<figure id=''><div class='cent' style='text-align:center;'><img src='/cocci-bot/error.png' class='alignnone size-medium' style='max-width:80%;'><figcaption>Figure - L'affichage du système d'exploitation</figcaption></div></figure>
Ainsi, nous voyons clairement le type de serveur en saisissant une adresse inexistante basée sur le serveur, avec les informations concernant le port (80) et le système d’exploitation Linux. 

Editons le fichier <b>/etc/apache2/conf-enabled/security.conf</b>
<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
sudo nano /etc/apache2/conf-enabled/security.conf 

</code></pre><hr>
Si la commande <b>nano</b> n'est pas reconnu, soit vous utiliser un éditeur de texte que vous avez l'habitude, soit vous installer <b>nano</b> de la manière suivante : 
<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
sudo apt-get install -y nano

</code></pre><hr>
Ensuite, nous allons remplacer la ligne :

<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
ServerTokens Os 

</code></pre><hr>
par

<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
ServerTokens Prod 

</code></pre><hr>
De plus, on va remplacer 

<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
ServerSignature On

</code></pre><hr>
par

<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
ServerSignature Off

</code></pre><hr>
Enfin, on actualise le serveur avec

<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
sudo service apache2 restart

</code></pre><hr>
<h3>Changer le port d'écoute d'Apache</h3>
On édite le fichier /etc/apache2/ports.conf

<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
sudo nano /etc/apache2/ports.conf

</code></pre><hr>
Puis changer la ligne Listen si vous souhaiteez changer de port.

Si vous voulez ajouter un port d'écoute, ajouter une ligne Listen XXX

<h3>Ajout d'un serveur virtuel</h3>
/etc/apache2/sites-available/default

Exemple

<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
<VirtualHost *:80>

        # The ServerName directive sets the request scheme, hostname and port that

        # the server uses to identify itself. This is used when creating

        # redirection URLs. In the context of virtual hosts, the ServerName

        # specifies what hostname must appear in the request's Host: header to

        # match this virtual host. For the default virtual host (this file) this

        # value is not decisive as it is used as a last resort host regardless.

        # However, you must set it for any further virtual host explicitly.

        #ServerName www.example.com

        ServerAdmin webmaster@localhost

        DocumentRoot /var/www/html

        # Available loglevels: trace8, ..., trace1, debug, info, notice, warn,

        # error, crit, alert, emerg.

        # It is also possible to configure the loglevel for particular

        # modules, e.g.

        #LogLevel info ssl:warn

        ErrorLog ${APACHE_LOG_DIR}/error.log

        CustomLog ${APACHE_LOG_DIR}/access.log combined

        # For most configuration files from conf-available/, which are

        # enabled or disabled at a global level, it is possible to

        # include a line for only one particular virtual host. For example the

        # following line enables the CGI configuration for this host only

        # after it has been globally disabled with "a2disconf".

        #Include conf-available/serve-cgi-bin.conf

</VirtualHost>

# vim: syntax=apache ts=4 sw=4 sts=4 sr noet

</code></pre><hr>
<h3>Protection d’un répertoire spécifique</h3>
\paragraph{

Dans certains cas, on souhaite interdire, ou du moins restreindre l’accès d’un dossier au utilisateurs.

Une des solutions consiste à configurer un fichier htaccess. <br>

}

Un fichier htaccess est un fichier de configuration Apache permettant de restreindre des répertoires.

Ce dernier est de la forme suivante : <br> 

<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
AuthUserFile /var/www/html/Admin/.htpasswd

AuthName "Veuillez saisir votre mot de passe pour ouvrir le dossier d'administration"

AuthType Basic

Require valid-user

</code></pre><hr>
Pour activer la lecture de ce fichier par le serveur Apache, il faut déclarer que la lecture est activée.

Dans le fichier 

<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
sudo nano /etc/apache2/apache2.conf

</code></pre><hr>
Mettre tous les 

<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
AllowOverride None

</code></pre><hr>
à 

<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
AllowOverride All

</code></pre><hr>
<h3>Htaccess</h3>
<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
AuthUserFile /var/www/html/root	//.htpasswd

AuthName "Accès protégé par un mot de passe"

AuthType Basic

Require valid-user

</code></pre><hr>
<h3>Htpasswd</h3>
<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
nico:(apr1\)KzVtay1XNnfyAYUyQ0SN/PnxKu0aI1

</code></pre><hr>
<h3>Définir les erreurs possibles</h3>
Cette section ne traite plus de la sécurité mais traite du confort d’utilisation du site en cas d’erreurs.

Il est possible de personnaliser le message d’erreur en fonction de son type.

<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
ErrorDocument 404 /Warning/notfound.html

ErrorDocument 401 /Warning/unhautorized.html

</code></pre><hr>
<h3>Afficher les erreurs Apache</h3>
<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
cat /var/log/apache2/error.log 

</code></pre><hr>

<h2 >Installation de MySql</h2>
<h3>Présentation</h3>
Un site qui commence à s’étoffer et à prendre de l’ampleur se verra un jour ou l’autre obligé d’utiliser une base de données pour traiter les informations et les stocker de manière efficace. 

Certaines  bases de données sont qualifiées de relationnelles car les éléments stockés entretiennent entre eux des points communs comme des noms, des catégories, des nombres… 

La plupart des logiciels de gestion de base de données sont basés sur la relation client-serveur.

C’est à dire que pour le serveur fasse correctement son travail (stocker et récupérer des données), il faut un logiciel client qui dialogue avec le serveur. 

Pour des raisons de facilités, nous installerons le logiciel client et serveur sur le même ordinateur, c'est à dire sur le serveur.

Aujourd’hui, de nombreux logiciels de gestion de base de données cohabitent : 

<ul>
    <li> MariaDB
</li>
    <li> MySql
</li>
    <li> SQLite
</li>
    <li> ...
</li>
</ul>
<h3>Installation</h3>
Dans le cas de ce tutoriel, nous installerons MySql.

Il faut saisir les deux commandes suivantes : 

<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
sudo apt-get install -y mysql-client

sudo apt-get install -y mysql-server

</code></pre><hr>
Selon la version de la distribution, un mot de passe peut être demandé ou non.

Par exemple, pour une distribution Ubuntu antérieur à la 18.04, un mot de passe est demandé, le cas échéant, le mot de passe par défaut est celui du compte root du serveur. 

Dans tous les cas, retenez bien le mot de passe pour la suite.

<h3>Connexion</h3>
Deux méthodes de connexion sont possibles, en fonction de la distribution: 

<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
mysql -u root -p

</code></pre><hr>
-u 	représente l’utilisateur : root

-p 	indique que l’utilisateur va saisir un mot de passe

<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
sudo mysql

</code></pre><hr>
Une fois le mot de passe saisi, un invité de commande apparaît

Le prompt mysql> indique que MySql a été correctement installé.

Pour ceux qui se sont connectés à MySql via > sudo mysql , il n’est pas recommandé de changer de mot de passe.

Pour les autres cas, vous pouvez changer de mot de passe en saisissant 

<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'nouveau_mot_de_passe';

</code></pre><hr>
Il vous faudra donc vous connectez à votre compte Mysql avant de saisir la commande. 

Nous allons ensuite créer un compte qui possède des droits étendue :

Dans MySql 

<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
CREATE USER 'user'@'localhost' IDENTIFIED BY 'password';

GRANT ALL PRIVILEGES ON *.* TO 'user'@'localhost';

</code></pre><hr>
Vous pouvez remplacer user par un identifiant de votre choix.

password est à remplacer par le mot de passe de votre choix. 

Enfin, si vous souhaitez supprimer un compte, il suffit de saisir

<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
DROP USER 'user'@'localhost';

</code></pre><hr>

<h3>Présentation</h3>
Pour un site Web, toutes les personnes qui se connectent au serveur via un navigateur Web (Firefox, Chrome…) sont appelées clients. 

Il faut distinguer un langage qui est exécuté du côté client et un langage qui est exécuté du côté serveur. 

Les langages clients sont par exemple le langage HTML,Javascript, Mysql 

Les langages serveurs sont Apache, Php ou Mysql. 

Lorsqu’un client se connecte sur un site, il envoie une requête à ce dernier. Cette requête passe par Apache qui demande à Php de générer la page HTML. 

La page est envoyée au client et est affichée du côté client. 

<h4>Installation</h4>
Pour installer PHP sur le serveur, il faut saisir :

<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
sudo apt-get install -y php7.0

</code></pre><hr>
Par la même occasion, nous allons installer le programme permettant de communiquer entre la base de données et le serveur

<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
sudo apt-get install -y php-mysql

</code></pre><hr>
<h3>Modifier le fichier de configuration de php</h3>
<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
sudo nano /etc/php/7.X/apache2/php.ini

</code></pre><hr>
<h3>Augmentation de la taille des fichiers de chargements</h3>
Il faut lire la fonction phpinfo() pour lire la variable :

puis modifier le fichier :

<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
sudo nano /etc/php/7.X/apache2/php.ini

</code></pre><hr>
<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
; Maximum size of POST data that PHP will accept.

; Its value may be 0 to disable the limit. It is ignored if POST data reading

; is disabled through enable_post_data_reading.

; http://php.net/post-max-size

post_max_size = 8M

</code></pre><hr>
puis

<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
; Maximum amount of memory a script may consume (128MB)

; http://php.net/memory-limit

memory_limit = 128M

</code></pre><hr>
puis 

<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
; Maximum allowed size for uploaded files.

; http://php.net/upload-max-filesize

upload_max_filesize = 100M

</code></pre><hr>

<h3>Présentation</h3>
Administrer une base de données peut s'avérer compliqué. Afin de le faire plus facilement, l'utilitaire PhpMyAdmin est là pour nous aider. 

Cela évite de rédiger les requêtes fastidieuses de MySql, il nous suffit juste de cocher des cases et de remplir les champs appropriés. 

<h3>Installation</h3>
Veuillez sasir la commande suivante : 

<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
sudo apt-get install -y phpmyadmin

</code></pre><hr>
Lors de l’installation, un mot de passe vous sera demandé : ce mot de passe sera utilisé pour se connecter à PhpMyAdmin. 

Ensuite, le gestionnaire d’installation va vous demander votre serveur HTTP.

Sélectionnez <b>Apache2</b>
<h3>Emplacement de PhpMyAdmin</h3>
<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
cd /usr/share/phpmyadmin

</code></pre><hr>
<h3>Configuration de PhpMyAdmin</h3>
<hr><pre style='background-color:#F5F5F5;padding-left:1em;'><code>
#sudo mysql --user=root

#Dans MySql :

#DROP USER 'root'@'localhost';

#CREATE USER 'root'@'localhost' IDENTIFIED BY 'password';

#GRANT ALL PRIVILEGES ON *.* TO 'root'@'localhost';

</code></pre><hr>

</body></html>